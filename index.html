<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic GIF Command-Line | FunnelFunction</title>
  <meta name="description" content="Self-resolving visual computation engine. Create brand-consistent graphics through mathematical convergence. Built on Intent Tensor Theory.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #13131a;
      --bg-tertiary: #1a1a24;
      --text-primary: #e8e8f0;
      --text-secondary: #a0a0b8;
      --text-tertiary: #70708c;
      --accent-cyan: #00d4ff;
      --accent-purple: #7b61ff;
      --accent-green: #00ff88;
      --accent-red: #ff3366;
      --accent-orange: #ff8c00;
      --font-mono: 'SF Mono', 'Fira Code', 'Consolas', monospace;
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    body {
      font-family: var(--font-mono);
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .header h1 {
      font-size: 1.5rem;
      color: var(--accent-cyan);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .header p {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }
    
    /* Terminal */
    .terminal {
      width: 100%;
      max-width: 900px;
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .terminal-header {
      display: flex;
      gap: 8px;
      margin-bottom: 1rem;
    }
    
    .terminal-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    
    .terminal-dot.red { background: #ff5f56; }
    .terminal-dot.yellow { background: #ffbd2e; }
    .terminal-dot.green { background: #27ca40; }
    
    .command-line {
      display: flex;
      align-items: center;
    }
    
    .command-prefix {
      color: var(--accent-cyan);
      margin-right: 8px;
      font-weight: bold;
    }
    
    #command-input {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      outline: none;
    }
    
    #command-input::placeholder {
      color: var(--text-tertiary);
    }
    
    /* Status */
    .status {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      max-width: 900px;
      width: 100%;
    }
    
    .status.success {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
    }
    
    .status.error {
      background: rgba(255, 51, 102, 0.1);
      border: 1px solid var(--accent-red);
      color: var(--accent-red);
    }
    
    .status.info {
      background: rgba(0, 212, 255, 0.1);
      border: 1px solid var(--accent-cyan);
      color: var(--accent-cyan);
    }
    
    .status.hidden { display: none; }
    
    /* Canvas */
    .canvas-container {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      max-width: 900px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    #preview-canvas {
      display: block;
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    
    /* Actions */
    .actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-family: inherit;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
    }
    
    .btn-primary {
      background: var(--accent-cyan);
      color: var(--bg-primary);
    }
    
    .btn-primary:hover {
      background: #00b8e0;
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--text-tertiary);
    }
    
    .btn-secondary:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }
    
    /* Quick Examples */
    .examples {
      width: 100%;
      max-width: 900px;
      margin-top: 1rem;
    }
    
    .examples h3 {
      color: var(--text-secondary);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
    }
    
    .example-category {
      margin-bottom: 1.5rem;
    }
    
    .example-category h4 {
      color: var(--accent-purple);
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .example-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .example-item {
      background: var(--bg-secondary);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border: 1px solid transparent;
    }
    
    .example-item:hover {
      background: var(--bg-tertiary);
      color: var(--accent-cyan);
      border-color: var(--accent-cyan);
    }
    
    .example-item .label {
      color: var(--accent-green);
      margin-right: 0.5rem;
    }
    
    .example-item .desc {
      color: var(--text-tertiary);
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }
    
    /* Palette definitions */
    .palettes {
      display: none; /* Hidden, just for reference */
    }
    
    /* Footer */
    .footer {
      margin-top: 2rem;
      text-align: center;
      color: var(--text-tertiary);
      font-size: 0.75rem;
    }
    
    .footer a {
      color: var(--accent-cyan);
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>âš¡ DYNAMIC GIF COMMAND-LINE</h1>
    <p>URL â†’ Manifest â†’ Emergence â†’ GIF</p>
    <p style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-tertiary);">
      Built on Intent Tensor Theory | <a href="https://intent-tensor-theory.com" style="color: var(--accent-purple);">ITT Docs</a>
    </p>
  </div>

  <!-- Terminal -->
  <div class="terminal">
    <div class="terminal-header">
      <div class="terminal-dot red"></div>
      <div class="terminal-dot yellow"></div>
      <div class="terminal-dot green"></div>
    </div>
    <div class="command-line">
      <span class="command-prefix">#</span>
      <input 
        type="text" 
        id="command-input" 
        placeholder="text=Hello World|scene=gradient|palette=oceanic"
        autocomplete="off"
        spellcheck="false"
      >
    </div>
  </div>

  <!-- Status -->
  <div id="status" class="status info">
    ğŸ’¡ Type a command or click an example below to generate a GIF
  </div>

  <!-- Canvas -->
  <div class="canvas-container">
    <canvas id="preview-canvas" width="400" height="400"></canvas>
  </div>

  <!-- Actions -->
  <div class="actions">
    <button class="btn btn-primary" id="render-btn">Render GIF</button>
    <button class="btn btn-secondary" id="download-btn">Download</button>
  </div>

  <!-- Quick Examples Library -->
  <div class="examples">
    <h3>ğŸ¨ QUICK EXAMPLES LIBRARY</h3>
    
    <!-- Simple Static -->
    <div class="example-category">
      <h4>ğŸ“ SIMPLE STATIC (Single Text)</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=Hello World">
          <span class="label">Minimal:</span> Hello World
          <div class="desc">Basic centered text, default styling</div>
        </div>
        <div class="example-item" data-cmd="text=FunnelFunction|scene=gradient|palette=oceanic">
          <span class="label">Brand:</span> Oceanic Gradient
          <div class="desc">Blue-teal gradient with brand text</div>
        </div>
        <div class="example-item" data-cmd="text=Innovation Drives Us|scene=gradient|palette=sunset">
          <span class="label">Warm:</span> Sunset Theme
          <div class="desc">Orange-red warm gradient</div>
        </div>
        <div class="example-item" data-cmd="text=Tech Excellence|scene=corporate|palette=midnight">
          <span class="label">Corporate:</span> Midnight Blue
          <div class="desc">Professional dark blue corporate style</div>
        </div>
        <div class="example-item" data-cmd="text=Grow Your Business|scene=gradient|palette=forest">
          <span class="label">Natural:</span> Forest Green
          <div class="desc">Fresh green nature-inspired theme</div>
        </div>
      </div>
    </div>
    
    <!-- Canvas Sizes -->
    <div class="example-category">
      <h4>ğŸ“ CANVAS SIZES (Aspect Ratios)</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=Instagram Post|scene=gradient|palette=sunset|canvas=1:1">
          <span class="label">Square:</span> 1:1 Instagram/Social
          <div class="desc">Perfect for social media posts</div>
        </div>
        <div class="example-item" data-cmd="text=YouTube Thumbnail|scene=gradient|palette=oceanic|canvas=16:9">
          <span class="label">Wide:</span> 16:9 YouTube/Video
          <div class="desc">YouTube thumbnails, video content</div>
        </div>
        <div class="example-item" data-cmd="text=Story/Reel|scene=gradient|palette=midnight|canvas=9:16">
          <span class="label">Vertical:</span> 9:16 Stories/Reels
          <div class="desc">Instagram Stories, TikTok, Reels</div>
        </div>
        <div class="example-item" data-cmd="text=Pinterest Pin|scene=gradient|palette=forest|canvas=2:3">
          <span class="label">Tall:</span> 2:3 Pinterest
          <div class="desc">Pinterest pins, portrait content</div>
        </div>
      </div>
    </div>
    
    <!-- Multi-Line Layouts -->
    <div class="example-category">
      <h4>ğŸ“„ MULTI-LINE LAYOUTS (Company + Tagline)</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=FunnelFunction\nB2B Lead Generation|scene=gradient|palette=oceanic">
          <span class="label">Brand + Tagline:</span> Two-line stack
          <div class="desc">Company name with tagline below</div>
        </div>
        <div class="example-item" data-cmd="text=ACME Corp\nInnovation â€¢ Excellence â€¢ Growth|scene=corporate|palette=midnight">
          <span class="label">Corporate:</span> Brand + Values
          <div class="desc">Professional with bullet-separated values</div>
        </div>
        <div class="example-item" data-cmd="text=Q4 2025\nRevenue Report|scene=gradient|palette=forest|canvas=16:9">
          <span class="label">Report:</span> Title + Subtitle
          <div class="desc">Clean report cover style</div>
        </div>
        <div class="example-item" data-cmd="text=Armstrong Knight\nCEO & Founder|scene=gradient|palette=sunset">
          <span class="label">Executive:</span> Name + Title
          <div class="desc">Leadership/speaker introduction</div>
        </div>
      </div>
    </div>
    
    <!-- Service Showcases -->
    <div class="example-category">
      <h4>ğŸ› ï¸ SERVICE SHOWCASES (Feature Lists)</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=Our Services\nâ€¢ Lead Generation\nâ€¢ Email Automation\nâ€¢ Analytics|scene=gradient|palette=oceanic">
          <span class="label">Services:</span> Bullet List
          <div class="desc">Service offering with bullet points</div>
        </div>
        <div class="example-item" data-cmd="text=FunnelFunction\nâœ“ Scrape Leads\nâœ“ Verify Emails\nâœ“ Auto Outreach|scene=gradient|palette=forest">
          <span class="label">Features:</span> Checkmark List
          <div class="desc">Feature list with checkmarks</div>
        </div>
        <div class="example-item" data-cmd="text=Why Choose Us?\nâ†’ AI Powered\nâ†’ 10x Faster\nâ†’ 80% Cost Savings|scene=gradient|palette=sunset">
          <span class="label">Benefits:</span> Arrow List
          <div class="desc">Value proposition with arrows</div>
        </div>
      </div>
    </div>
    
    <!-- Statistics & Numbers -->
    <div class="example-category">
      <h4>ğŸ“Š STATISTICS & NUMBERS</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=10,000+\nLeads Generated|scene=gradient|palette=oceanic|canvas=1:1">
          <span class="label">Big Number:</span> Stat + Label
          <div class="desc">Impressive statistic highlight</div>
        </div>
        <div class="example-item" data-cmd="text=Revenue Up\n+47%|scene=gradient|palette=forest">
          <span class="label">Growth:</span> Percentage Gain
          <div class="desc">Growth metric announcement</div>
        </div>
        <div class="example-item" data-cmd="text=$2.4M ARR\nQ4 2025|scene=corporate|palette=midnight">
          <span class="label">Financial:</span> ARR Milestone
          <div class="desc">Financial milestone announcement</div>
        </div>
      </div>
    </div>
    
    <!-- Call to Actions -->
    <div class="example-category">
      <h4>ğŸ¯ CALL TO ACTIONS</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=Start Free Trial\nNo Credit Card Required|scene=gradient|palette=oceanic">
          <span class="label">CTA:</span> Free Trial
          <div class="desc">Conversion-focused with reassurance</div>
        </div>
        <div class="example-item" data-cmd="text=Book a Demo\nSee It In Action|scene=gradient|palette=sunset">
          <span class="label">CTA:</span> Demo Request
          <div class="desc">Demo booking prompt</div>
        </div>
        <div class="example-item" data-cmd="text=Limited Offer\n50% OFF Today Only|scene=gradient|palette=sunset">
          <span class="label">Urgency:</span> Flash Sale
          <div class="desc">Limited time offer with urgency</div>
        </div>
      </div>
    </div>
    
    <!-- Event & Announcements -->
    <div class="example-category">
      <h4>ğŸ“¢ EVENTS & ANNOUNCEMENTS</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=ğŸš€ NEW FEATURE\nAI Email Writer|scene=gradient|palette=oceanic">
          <span class="label">Launch:</span> Feature Announcement
          <div class="desc">New feature launch graphic</div>
        </div>
        <div class="example-item" data-cmd="text=WEBINAR\nJan 15, 2025 @ 2PM EST|scene=gradient|palette=midnight">
          <span class="label">Event:</span> Webinar Promo
          <div class="desc">Event date and time announcement</div>
        </div>
        <div class="example-item" data-cmd="text=ğŸ‰ WE'RE HIRING!\nJoin Our Team|scene=gradient|palette=forest">
          <span class="label">Hiring:</span> Recruitment
          <div class="desc">Job opening announcement</div>
        </div>
        <div class="example-item" data-cmd="text=Version 2.0\nNow Available|scene=gradient|palette=sunset">
          <span class="label">Release:</span> Version Launch
          <div class="desc">Software version release</div>
        </div>
      </div>
    </div>
    
    <!-- Quotes & Testimonials -->
    <div class="example-category">
      <h4>ğŸ’¬ QUOTES & TESTIMONIALS</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="text=\"Best lead gen tool we've used\"\nâ€” Sarah Chen, VP Sales|scene=gradient|palette=oceanic">
          <span class="label">Testimonial:</span> Customer Quote
          <div class="desc">Customer testimonial with attribution</div>
        </div>
        <div class="example-item" data-cmd="text=Think Different.\nâ€” Steve Jobs|scene=minimal|palette=midnight">
          <span class="label">Inspiration:</span> Famous Quote
          <div class="desc">Inspirational quote attribution</div>
        </div>
      </div>
    </div>
    
    <!-- Complex Multi-Frame (Coming Soon) -->
    <div class="example-category">
      <h4>ğŸ¬ MULTI-FRAME ANIMATED SEQUENCES</h4>
      <div class="example-list">
        <div class="example-item" data-cmd="sequence=Consultations~Build Apps~Scale Fast~Profit ğŸ’°|palette=oceanic|timing=2s">
          <span class="label">Services:</span> 4-Frame Business Sequence
          <div class="desc">Animated service showcase (use ~ to separate frames)</div>
        </div>
        <div class="example-item" data-cmd="sequence=Q4 Results~Revenue Up 23%~Expanding Markets~2025 Outlook|palette=midnight|timing=3s">
          <span class="label">Corporate:</span> Quarterly Report Animation
          <div class="desc">Professional 4-frame announcement</div>
        </div>
        <div class="example-item" data-cmd="sequence=ğŸš€ Launching Soon~New Features~Better UX~Coming January|palette=sunset|timing=1.5s">
          <span class="label">Launch:</span> Product Teaser
          <div class="desc">Excitement-building reveal sequence</div>
        </div>
        <div class="example-item" data-cmd="sequence=Step 1: Sign Up~Step 2: Connect~Step 3: Launch~Step 4: Profit!|palette=forest|timing=2s">
          <span class="label">Tutorial:</span> How It Works
          <div class="desc">Step-by-step process animation</div>
        </div>
        <div class="example-item" data-cmd="sequence=10,000+~Leads Generated~Every Month~FunnelFunction|palette=oceanic|timing=1s">
          <span class="label">Stats:</span> Metric Animation
          <div class="desc">Fast-paced statistic showcase</div>
        </div>
        <div class="example-item" data-cmd="sequence=Hello~We Are~FunnelFunction~Let's Build Together|palette=purple|timing=1.5s|canvas=16:9">
          <span class="label">Intro:</span> Brand Introduction
          <div class="desc">Widescreen brand animation</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>
      Built by <a href="https://funnelfunction.com">Armstrong Knight & Abdullah Khan</a> |
      Powered by <a href="https://intent-tensor-theory.com">Intent Tensor Theory</a>
    </p>
    <p style="margin-top: 0.5rem;">
      AI Collaboration: Claude (Anthropic), ChatGPT (OpenAI), Grok (xAI), Gemini (Google)
    </p>
    <p style="margin-top: 0.5rem;">
      <a href="https://github.com/FunnelFunction/0.0_Dynamic_GIF_Command-Line">GitHub Repository</a>
    </p>
  </div>

  <script>
    /**
     * DYNAMIC GIF COMMAND-LINE ENGINE
     * 
     * Self-resolving visual computation through mathematical convergence.
     * Based on Intent Tensor Theory (ITT) coordinate system.
     * 
     * Collapse Genesis Stack: Î¦ â†’ âˆ‡Î¦ â†’ âˆ‡Ã—F â†’ âˆ‡Â²Î¦ â†’ Ïq
     */

    // Color Palettes - Brand Attractors
    const PALETTES = {
      oceanic: {
        gradient: ['#0066cc', '#00aacc', '#00ccaa'],
        text: '#ffffff',
        name: 'Oceanic'
      },
      sunset: {
        gradient: ['#ff6b35', '#f7931a', '#ffcc00'],
        text: '#ffffff',
        name: 'Sunset'
      },
      midnight: {
        gradient: ['#1a1a2e', '#16213e', '#0f3460'],
        text: '#e8e8f0',
        name: 'Midnight'
      },
      forest: {
        gradient: ['#134e5e', '#1a8a5a', '#2ecc71'],
        text: '#ffffff',
        name: 'Forest'
      },
      purple: {
        gradient: ['#667eea', '#764ba2', '#f093fb'],
        text: '#ffffff',
        name: 'Purple'
      },
      minimal: {
        gradient: ['#ffffff', '#f8f9fa', '#e9ecef'],
        text: '#1a1a2e',
        name: 'Minimal'
      },
      corporate: {
        gradient: ['#2c3e50', '#3498db', '#2980b9'],
        text: '#ffffff',
        name: 'Corporate'
      },
      neon: {
        gradient: ['#0a0a0f', '#1a1a2e', '#0a0a0f'],
        text: '#00ff88',
        name: 'Neon'
      }
    };

    // Canvas aspect ratios
    const CANVAS_SIZES = {
      '1:1': { width: 400, height: 400 },
      '16:9': { width: 640, height: 360 },
      '9:16': { width: 360, height: 640 },
      '4:3': { width: 480, height: 360 },
      '2:3': { width: 400, height: 600 },
      '4:5': { width: 400, height: 500 }
    };

    // DOM Elements
    const commandInput = document.getElementById('command-input');
    const statusEl = document.getElementById('status');
    const canvas = document.getElementById('preview-canvas');
    const ctx = canvas.getContext('2d');
    const renderBtn = document.getElementById('render-btn');
    const downloadBtn = document.getElementById('download-btn');

    // Current state
    let currentManifest = null;
    let gifData = null;

    /**
     * Parse command string into manifest
     * Supports: sequence=Frame1|Frame2|Frame3 for multi-frame
     */
    function parseCommand(cmdStr) {
      const manifest = {
        text: 'Hello World',
        scene: 'gradient',
        palette: 'oceanic',
        canvas: '1:1',
        animation: 'none',
        sequence: null,
        timing: 2000, // ms per frame
        loop: true
      };

      // Split by | but preserve sequence values
      // First check if there's a sequence parameter
      const sequenceMatch = cmdStr.match(/sequence=([^|]+(?:\|[^|=]+)*?)(?=\|[a-zA-Z]+=|$)/);
      if (sequenceMatch) {
        // Extract sequence frames (split by ~ for sequence separator)
        manifest.sequence = sequenceMatch[1].split('~').map(s => s.trim());
        // Remove sequence from cmdStr for further parsing
        cmdStr = cmdStr.replace(sequenceMatch[0], '');
      }

      // Split by | and parse each param
      const parts = cmdStr.split('|').filter(p => p.trim());
      for (const part of parts) {
        const [key, ...valueParts] = part.split('=');
        const value = valueParts.join('='); // Handle = in value
        if (key && value) {
          const k = key.trim();
          const v = value.trim();
          
          if (k === 'timing') {
            // Parse timing: "2s" -> 2000, "500ms" -> 500
            if (v.endsWith('s') && !v.endsWith('ms')) {
              manifest.timing = parseFloat(v) * 1000;
            } else if (v.endsWith('ms')) {
              manifest.timing = parseFloat(v);
            } else {
              manifest.timing = parseFloat(v) * 1000; // Default to seconds
            }
          } else if (k === 'loop') {
            manifest.loop = v !== 'false' && v !== '0';
          } else {
            manifest[k] = v;
          }
        }
      }

      // Handle newlines in text (convert \n to actual newlines)
      manifest.text = manifest.text.replace(/\\n/g, '\n');

      return manifest;
    }

    /**
     * Emerge full specification from minimal manifest
     * (Fiber bundle projection: 5 inputs â†’ 50+ properties)
     */
    function emerge(manifest) {
      const palette = PALETTES[manifest.palette] || PALETTES.oceanic;
      const canvasSize = CANVAS_SIZES[manifest.canvas] || CANVAS_SIZES['1:1'];

      return {
        ...manifest,
        colors: palette,
        dimensions: canvasSize,
        typography: {
          fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',
          fontSize: calculateFontSize(manifest.text, canvasSize),
          fontWeight: 700,
          lineHeight: 1.3,
          textAlign: 'center'
        },
        layout: {
          x: canvasSize.width / 2,
          y: canvasSize.height / 2,
          padding: 40,
          maxWidth: canvasSize.width - 80
        }
      };
    }

    /**
     * Calculate optimal font size based on text and canvas
     */
    function calculateFontSize(text, canvasSize) {
      const lines = text.split('\n');
      const maxLineLength = Math.max(...lines.map(l => l.length));
      const lineCount = lines.length;
      
      // Base size on canvas width and text length
      let baseSize = Math.min(canvasSize.width, canvasSize.height) / 8;
      
      // Reduce for longer text
      if (maxLineLength > 20) baseSize *= 0.7;
      if (maxLineLength > 30) baseSize *= 0.7;
      if (lineCount > 2) baseSize *= 0.85;
      if (lineCount > 4) baseSize *= 0.8;
      
      return Math.max(16, Math.min(baseSize, 72));
    }

    /**
     * Word wrap text to fit within maxWidth
     */
    function wrapText(ctx, text, maxWidth) {
      const lines = text.split('\n');
      const wrappedLines = [];
      
      for (const line of lines) {
        const words = line.split(' ');
        let currentLine = '';
        
        for (const word of words) {
          const testLine = currentLine + (currentLine ? ' ' : '') + word;
          const metrics = ctx.measureText(testLine);
          
          if (metrics.width > maxWidth && currentLine) {
            wrappedLines.push(currentLine);
            currentLine = word;
          } else {
            currentLine = testLine;
          }
        }
        
        if (currentLine) {
          wrappedLines.push(currentLine);
        }
      }
      
      return wrappedLines;
    }

    /**
     * Render a single frame to canvas
     * @param {Object} spec - Emerged specification
     * @param {string} textOverride - Optional text override for sequence frames
     * @returns {ImageData} - Rendered frame data
     */
    function renderFrame(spec, textOverride = null) {
      const { dimensions, colors, typography, layout } = spec;
      const text = textOverride || spec.text;
      
      // Resize canvas
      canvas.width = dimensions.width;
      canvas.height = dimensions.height;
      
      // Draw gradient background
      const gradient = ctx.createLinearGradient(0, 0, dimensions.width, dimensions.height);
      colors.gradient.forEach((color, i) => {
        gradient.addColorStop(i / (colors.gradient.length - 1), color);
      });
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, dimensions.width, dimensions.height);
      
      // Recalculate font size for this specific text
      const fontSize = calculateFontSize(text, dimensions);
      
      // Configure text
      ctx.fillStyle = colors.text;
      ctx.font = `${typography.fontWeight} ${fontSize}px ${typography.fontFamily}`;
      ctx.textAlign = typography.textAlign;
      ctx.textBaseline = 'middle';
      
      // Wrap text to fit
      const wrappedLines = wrapText(ctx, text, layout.maxWidth);
      const lineHeight = fontSize * typography.lineHeight;
      const totalHeight = wrappedLines.length * lineHeight;
      const startY = layout.y - totalHeight / 2 + lineHeight / 2;
      
      // Draw each line
      wrappedLines.forEach((line, i) => {
        ctx.fillText(line, layout.x, startY + i * lineHeight);
      });
      
      return ctx.getImageData(0, 0, dimensions.width, dimensions.height);
    }

    /**
     * Render to canvas (single frame - backward compatible)
     */
    function render(spec) {
      renderFrame(spec);
      return canvas;
    }

    /**
     * ============================================
     * INLINE GIF ENCODER - No External Dependencies
     * Based on LZW compression for GIF89a format
     * ============================================
     */
    
    class GifEncoder {
      constructor(width, height) {
        this.width = width;
        this.height = height;
        this.frames = [];
        this.globalPalette = null;
      }
      
      // Quantize image to 256 colors using median cut
      quantize(imageData) {
        const pixels = imageData.data;
        const colorCounts = new Map();
        
        // Count color frequencies
        for (let i = 0; i < pixels.length; i += 4) {
          // Reduce color space to speed up
          const r = pixels[i] & 0xF8;
          const g = pixels[i + 1] & 0xF8;
          const b = pixels[i + 2] & 0xF8;
          const key = (r << 16) | (g << 8) | b;
          colorCounts.set(key, (colorCounts.get(key) || 0) + 1);
        }
        
        // Get top 256 colors
        const sortedColors = [...colorCounts.entries()]
          .sort((a, b) => b[1] - a[1])
          .slice(0, 256)
          .map(([color]) => color);
        
        // Pad to 256 colors
        while (sortedColors.length < 256) {
          sortedColors.push(0);
        }
        
        // Build palette
        const palette = new Uint8Array(256 * 3);
        for (let i = 0; i < 256; i++) {
          const color = sortedColors[i];
          palette[i * 3] = (color >> 16) & 0xFF;
          palette[i * 3 + 1] = (color >> 8) & 0xFF;
          palette[i * 3 + 2] = color & 0xFF;
        }
        
        // Build color lookup
        const colorLookup = new Map();
        sortedColors.forEach((color, index) => {
          colorLookup.set(color, index);
        });
        
        // Map pixels to palette indices
        const indices = new Uint8Array(this.width * this.height);
        for (let i = 0, j = 0; i < pixels.length; i += 4, j++) {
          const r = pixels[i] & 0xF8;
          const g = pixels[i + 1] & 0xF8;
          const b = pixels[i + 2] & 0xF8;
          const key = (r << 16) | (g << 8) | b;
          
          if (colorLookup.has(key)) {
            indices[j] = colorLookup.get(key);
          } else {
            // Find nearest color
            let minDist = Infinity;
            let nearest = 0;
            for (let k = 0; k < sortedColors.length; k++) {
              const pc = sortedColors[k];
              const pr = (pc >> 16) & 0xFF;
              const pg = (pc >> 8) & 0xFF;
              const pb = pc & 0xFF;
              const dist = (r - pr) ** 2 + (g - pg) ** 2 + (b - pb) ** 2;
              if (dist < minDist) {
                minDist = dist;
                nearest = k;
              }
            }
            indices[j] = nearest;
          }
        }
        
        return { palette, indices };
      }
      
      // LZW encode
      lzwEncode(indices, minCodeSize) {
        const clearCode = 1 << minCodeSize;
        const endCode = clearCode + 1;
        
        let codeSize = minCodeSize + 1;
        let nextCode = endCode + 1;
        const maxCode = 4096;
        
        const dictionary = new Map();
        for (let i = 0; i < clearCode; i++) {
          dictionary.set(String.fromCharCode(i), i);
        }
        
        const output = [];
        let bits = 0;
        let bitCount = 0;
        
        const writeBits = (code, size) => {
          bits |= code << bitCount;
          bitCount += size;
          while (bitCount >= 8) {
            output.push(bits & 0xFF);
            bits >>= 8;
            bitCount -= 8;
          }
        };
        
        writeBits(clearCode, codeSize);
        
        let current = String.fromCharCode(indices[0]);
        
        for (let i = 1; i < indices.length; i++) {
          const next = String.fromCharCode(indices[i]);
          const combined = current + next;
          
          if (dictionary.has(combined)) {
            current = combined;
          } else {
            writeBits(dictionary.get(current), codeSize);
            
            if (nextCode < maxCode) {
              dictionary.set(combined, nextCode++);
              if (nextCode > (1 << codeSize) && codeSize < 12) {
                codeSize++;
              }
            } else {
              writeBits(clearCode, codeSize);
              codeSize = minCodeSize + 1;
              nextCode = endCode + 1;
              dictionary.clear();
              for (let j = 0; j < clearCode; j++) {
                dictionary.set(String.fromCharCode(j), j);
              }
            }
            
            current = next;
          }
        }
        
        writeBits(dictionary.get(current), codeSize);
        writeBits(endCode, codeSize);
        
        if (bitCount > 0) {
          output.push(bits & 0xFF);
        }
        
        return new Uint8Array(output);
      }
      
      addFrame(imageData, delay) {
        const { palette, indices } = this.quantize(imageData);
        this.frames.push({ palette, indices, delay: Math.round(delay / 10) });
      }
      
      encode() {
        const chunks = [];
        
        // GIF Header
        chunks.push(new Uint8Array([0x47, 0x49, 0x46, 0x38, 0x39, 0x61])); // GIF89a
        
        // Logical Screen Descriptor
        const lsd = new Uint8Array(7);
        lsd[0] = this.width & 0xFF;
        lsd[1] = (this.width >> 8) & 0xFF;
        lsd[2] = this.height & 0xFF;
        lsd[3] = (this.height >> 8) & 0xFF;
        lsd[4] = 0xF7; // Global color table, 256 colors
        lsd[5] = 0; // Background color index
        lsd[6] = 0; // Pixel aspect ratio
        chunks.push(lsd);
        
        // Global Color Table (from first frame)
        chunks.push(this.frames[0].palette);
        
        // Netscape extension for looping
        chunks.push(new Uint8Array([
          0x21, 0xFF, 0x0B,
          0x4E, 0x45, 0x54, 0x53, 0x43, 0x41, 0x50, 0x45, // NETSCAPE
          0x32, 0x2E, 0x30, // 2.0
          0x03, 0x01,
          0x00, 0x00, // Loop count (0 = infinite)
          0x00
        ]));
        
        // Add each frame
        for (const frame of this.frames) {
          // Graphic Control Extension
          const gce = new Uint8Array(8);
          gce[0] = 0x21; // Extension introducer
          gce[1] = 0xF9; // Graphic control label
          gce[2] = 0x04; // Block size
          gce[3] = 0x00; // Packed byte (no transparency)
          gce[4] = frame.delay & 0xFF;
          gce[5] = (frame.delay >> 8) & 0xFF;
          gce[6] = 0x00; // Transparent color index
          gce[7] = 0x00; // Block terminator
          chunks.push(gce);
          
          // Image Descriptor
          const id = new Uint8Array(10);
          id[0] = 0x2C; // Image separator
          id[1] = 0; id[2] = 0; // Left
          id[3] = 0; id[4] = 0; // Top
          id[5] = this.width & 0xFF;
          id[6] = (this.width >> 8) & 0xFF;
          id[7] = this.height & 0xFF;
          id[8] = (this.height >> 8) & 0xFF;
          id[9] = 0x00; // No local color table
          chunks.push(id);
          
          // LZW Minimum Code Size
          chunks.push(new Uint8Array([0x08]));
          
          // LZW Data
          const lzwData = this.lzwEncode(frame.indices, 8);
          
          // Split into sub-blocks (max 255 bytes each)
          let offset = 0;
          while (offset < lzwData.length) {
            const blockSize = Math.min(255, lzwData.length - offset);
            chunks.push(new Uint8Array([blockSize]));
            chunks.push(lzwData.slice(offset, offset + blockSize));
            offset += blockSize;
          }
          
          // Block terminator
          chunks.push(new Uint8Array([0x00]));
        }
        
        // GIF Trailer
        chunks.push(new Uint8Array([0x3B]));
        
        // Combine all chunks
        const totalLength = chunks.reduce((sum, chunk) => sum + chunk.length, 0);
        const result = new Uint8Array(totalLength);
        let offset = 0;
        for (const chunk of chunks) {
          result.set(chunk, offset);
          offset += chunk.length;
        }
        
        return result;
      }
      
      toDataURL() {
        const bytes = this.encode();
        let binary = '';
        for (let i = 0; i < bytes.length; i++) {
          binary += String.fromCharCode(bytes[i]);
        }
        return 'data:image/gif;base64,' + btoa(binary);
      }
    }

    /**
     * Generate animated GIF from frames
     */
    async function generateAnimatedGIF(frames, width, height) {
      try {
        const encoder = new GifEncoder(width, height);
        
        for (const frame of frames) {
          encoder.addFrame(frame.imageData, frame.delay);
        }
        
        return encoder.toDataURL();
      } catch (error) {
        console.error('GIF encoding error:', error);
        return canvas.toDataURL('image/png');
      }
    }

    /**
     * Generate GIF from canvas (single frame fallback)
     */
    async function generateGIF(canvas) {
      return canvas.toDataURL('image/png');
    }

    /**
     * Main execution pipeline
     * Supports both single-frame and multi-frame sequences
     */
    async function execute(cmdStr) {
      try {
        // 1. Parse
        statusEl.className = 'status info';
        statusEl.textContent = 'âš™ï¸ Parsing command...';
        const manifest = parseCommand(cmdStr);
        console.log('ğŸ“ Parsed:', manifest);
        
        // 2. Emerge base specification
        statusEl.textContent = 'ğŸŒ€ Emerging specification...';
        const spec = emerge(manifest);
        console.log('ğŸ“‹ Emerged:', spec);
        currentManifest = spec;
        
        // Check if this is a multi-frame sequence
        const isSequence = manifest.sequence && manifest.sequence.length > 1;
        
        if (isSequence) {
          // MULTI-FRAME SEQUENCE
          statusEl.textContent = `ğŸ¬ Rendering ${manifest.sequence.length} frames...`;
          
          const frames = [];
          const { dimensions } = spec;
          
          // Render each frame in sequence
          for (let i = 0; i < manifest.sequence.length; i++) {
            const frameText = manifest.sequence[i].replace(/\\n/g, '\n');
            statusEl.textContent = `ğŸ¬ Rendering frame ${i + 1}/${manifest.sequence.length}: "${frameText.substring(0, 20)}..."`;
            
            const imageData = renderFrame(spec, frameText);
            frames.push({
              imageData: imageData,
              delay: manifest.timing
            });
            
            // Small delay to allow UI update
            await new Promise(r => setTimeout(r, 50));
          }
          
          // Show last frame in preview
          renderFrame(spec, manifest.sequence[manifest.sequence.length - 1].replace(/\\n/g, '\n'));
          
          // Generate animated GIF
          statusEl.textContent = 'ğŸ“¦ Encoding animated GIF...';
          try {
            gifData = await generateAnimatedGIF(frames, dimensions.width, dimensions.height);
            
            const bytes = Math.round(gifData.length * 0.75);
            const duration = (manifest.sequence.length * manifest.timing / 1000).toFixed(1);
            statusEl.className = 'status success';
            statusEl.textContent = `âœ“ Animated GIF ready! ${manifest.sequence.length} frames, ${duration}s duration`;
          } catch (gifError) {
            console.warn('GIF encoding failed, using PNG:', gifError);
            gifData = canvas.toDataURL('image/png');
            statusEl.className = 'status success';
            statusEl.textContent = `âœ“ PNG ready (GIF encoding unavailable). ${manifest.sequence.length} frames designed.`;
          }
          
        } else {
          // SINGLE FRAME
          statusEl.textContent = 'ğŸ¨ Rendering...';
          render(spec);
          
          // Generate single frame
          statusEl.textContent = 'ğŸ“¦ Generating image...';
          gifData = await generateGIF(canvas);
          
          const bytes = Math.round(gifData.length * 0.75);
          statusEl.className = 'status success';
          statusEl.textContent = `âœ“ Image ready! ${bytes.toLocaleString()} bytes, 1 frame`;
        }
        
      } catch (error) {
        console.error('Error:', error);
        statusEl.className = 'status error';
        statusEl.textContent = `âœ— Error: ${error.message}`;
      }
    }

    /**
     * Download current GIF/PNG
     */
    function download() {
      if (!gifData) {
        statusEl.className = 'status error';
        statusEl.textContent = 'âœ— No image to download. Render first!';
        return;
      }
      
      // Detect file type from data URL
      const isGif = gifData.startsWith('data:image/gif');
      const ext = isGif ? 'gif' : 'png';
      
      const link = document.createElement('a');
      link.download = `dynamic-gif-${Date.now()}.${ext}`;
      link.href = gifData;
      link.click();
    }

    // Event Listeners
    commandInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const cmd = commandInput.value.trim();
        if (cmd) execute(cmd);
      }
    });

    renderBtn.addEventListener('click', () => {
      const cmd = commandInput.value.trim();
      if (cmd) execute(cmd);
    });

    downloadBtn.addEventListener('click', download);

    // Quick example click handlers
    document.querySelectorAll('.example-item').forEach(item => {
      item.addEventListener('click', () => {
        const cmd = item.dataset.cmd;
        commandInput.value = cmd;
        execute(cmd);
      });
    });

    // URL parameter support
    function loadFromURL() {
      const hash = window.location.hash.slice(1);
      if (hash) {
        const cmd = decodeURIComponent(hash);
        commandInput.value = cmd;
        execute(cmd);
      }
    }

    // Initialize
    console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘        DYNAMIC GIF COMMAND-LINE v1.1                         â•‘
â•‘        URL â†’ Manifest â†’ Emergence â†’ GIF                      â•‘
â•‘                                                              â•‘
â•‘        Built on Intent Tensor Theory                         â•‘
â•‘        Pre-Emergent Visual Dynamics                          â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `);
    
    loadFromURL();
  </script>
</body>
</html>
